<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Class 5</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-default_background {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 237, 214, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 237, 214, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(0, 0, 0, 0.06); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(249, 228, 188, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="6727a25f-2bed-44e0-8a55-c5522109276b" class="page sans"><header><h1 class="page-title">Class 5</h1><p class="page-description"></p></header><div class="page-body"><p id="3473a5b7-fb0b-46bb-9310-d1bec9670dc4" class="">Topic Chapter 2 Operating System Organization</p><p id="1056cb2a-7d52-808b-9d8f-f58b0433d073" class="">A key requirement for an operating system is to support several activities at once.</p><p id="1056cb2a-7d52-80fc-ab1a-f9cb5d0d5ffd" class="">The operating system must <code>time-share</code> the resources of the computer among these prcesses. For example, even if there are more processes than there are hardware CPUs, the operating system must ensure that all of the processes get a chance to execute. There must also be <code>isolation</code> between the processes so they cannot create problems for each other.</p><p id="1056cb2a-7d52-8016-add2-c684a80c231f" class="">Opearating system must fulfill three requirements for its processes:</p><ol type="1" id="1056cb2a-7d52-8090-b996-f58b839bb1db" class="numbered-list" start="1"><li>Multiplexing / Time-sharing of hardware resources among processes</li></ol><ol type="1" id="70bf81ac-7abb-4e1c-895b-5e3b4a74b5f6" class="numbered-list" start="2"><li>Isolation</li></ol><ol type="1" id="fe3097f7-ff52-4229-a32e-c567e2ae5fbf" class="numbered-list" start="3"><li>Interaction</li></ol><p id="67bc704b-ec31-4ca0-8faf-0299fd68ac63" class="">XV6 is written in LP64C.</p><ul id="1056cb2a-7d52-8047-82cd-de5e5ba2cafa" class="bulleted-list"><li style="list-style-type:disc">Int = 32 bit</li></ul><ul id="1056cb2a-7d52-8009-b963-d154ce7eae7d" class="bulleted-list"><li style="list-style-type:disc">Longs and poitners  = 64 bit</li></ul><figure id="a3fb1a93-8746-422e-8a02-c3569bc975dd" class="image"><a href="image%205.png"><img style="width:708px" src="image%205.png"/></a></figure><p id="1056cb2a-7d52-801e-9088-ed3c90666f2a" class="">We will center our focus around a <code>monolithic</code> kernel.</p><p id="1056cb2a-7d52-8016-a5ae-e1ac0b7dcb12" class="">The ‘Core 1’ and ‘Core 2’ are the ‘harts’ that show up when you open XV6.</p><p id="1056cb2a-7d52-8097-9c67-ed881e8d1583" class="">UART is a protocol for communicating with hardware. (I think) (I was right)</p><p id="1056cb2a-7d52-807c-be4e-d74a60b038a0" class="">To achieve strong isolation its helpful to forbid applications from directly accessing sensitive hardware resources, and instead to abstract the resources into services.</p><p id="1056cb2a-7d52-80ce-908d-ef5547713e38" class="">“Abstraction greatly simplifies the process.”</p><p id="1056cb2a-7d52-807b-8a91-cd1872f9ae9b" class="">Unix transparently switches hardware CPUs among processes, saving and restoring register state as necessary, so that applications don’t have to be aware of time sharing. This transparency allows the operating system to share CPUs <mark class="highlight-brown_background">even if some applications are in infinite loops.</mark></p><p id="1056cb2a-7d52-801e-abb8-c21618164173" class="">Many forms of interaction among Unix process occur via file descriptors.</p><h2 id="1056cb2a-7d52-80e7-a024-ec0a33423a02" class="">User mode, Supervisor mode, and system calls</h2><p id="1056cb2a-7d52-80a3-ae0f-fe70e554405a" class="">To achieve strong isolation, the operating system must arrange that applications cannot <mark class="highlight-red">modify </mark>(or even <mark class="highlight-red">read</mark>) the operating system’s <mark class="highlight-red">data structures</mark> and <mark class="highlight-red">instructions </mark>and that applications cannot access other <mark class="highlight-red">processes’ memory</mark>. (Hacking)</p><figure id="a1be40f3-b1b4-494d-90be-455d7c63e5cd" class="image"><a href="image%206.png"><img style="width:708px" src="image%206.png"/></a></figure><p id="1056cb2a-7d52-809b-b9c5-d69b8e9149ed" class="">CPUs provide hardware support for strong isolation. For example, RISC-V has three modes</p><ol type="1" id="7bf16b0f-ef83-4791-b697-22dd84cc1c07" class="numbered-list" start="1"><li><mark class="highlight-red">User mode</mark> : Where user applications are run and basic operations are performed. This runs in user space.</li></ol><ol type="1" id="1086cb2a-7d52-80f8-af92-db551f1c51cc" class="numbered-list" start="2"><li><mark class="highlight-red">Supervisor mode</mark> : Where higher privileged instructions are performed and requested by processes. This runs in kernel space.</li></ol><ol type="1" id="1086cb2a-7d52-8068-94c8-d5a561a07602" class="numbered-list" start="3"><li><mark class="highlight-red">Machine mode</mark> : This is closest to the hardware and is usually mostly intended for setting up the computer during boot. Xv6 executes a few lines in machine mode and then changes to supervisor mode.</li></ol><p id="1056cb2a-7d52-8024-850b-fee09b34677d" class="">If an application in user mode attempts to execute a privileged instruction, then the CPU doesn’t execute the instruction, but switches to supervisor mode so that supervisor-mode code can terminate the application, because it did something it shouldn’t be doing. (Security measure)</p><p id="1086cb2a-7d52-803b-902a-f2ff2d5ace30" class="">An application can execute only user-mode instructions (e.g., adding numbers, etc.) and is said to be running in user space, while the software in supervisor mode can also execute privileged instructions and is said to be running in kernel space<mark class="highlight-brown_background">. The software running in kernel space (or in supervisor mode) is called the kernel.</mark></p><p id="65d63c7c-79a9-48f1-a4d6-a33bf8f4b39a" class="">An application that wants to invoke a kernel function (e.g., the read system call in xv6) must transition to the kernel; it cannot invoke a kernel function directly. CPUs provide a special instruction that switches from user mode to supervisor mode and enters the kernel at a specified entry point. (svec and uvec (Not sure check again)) (RISC-V uses the ecall instruction for this purpose.)</p><p id="c0801496-7469-4162-a899-45c862f2c8a4" class="">Once in <mark class="highlight-red">supervisor mode</mark>, the kernel validates the system call&#x27;s arguments (e.g., checking if the provided address is within the application&#x27;s memory), determines if the application is permitted to perform the requested operation (e.g., verifying write permissions for a specified file), and then either denies or executes the request. It&#x27;s crucial that the <mark class="highlight-red">kernel controls the entry point for transitions to supervisor mode</mark>; <mark class="highlight-brown_background">if applications could choose the kernel entry point, a malicious program could bypass argument validation, potentially compromising system security. (Windows defender actually has a feature against this sort of thing)</mark></p><h3 id="1086cb2a-7d52-8027-b264-e7130fd2aa79" class="">Types of kernels</h3><p id="1056cb2a-7d52-800d-a668-c51d026d4219" class=""><strong>Monolithic kernel</strong> : The entire operating system resides in the kernel, so that the implementations of all system calls run in supervisor mode. This bundles a wide range of system services directly into the kernel.<div class="indented"><p id="1086cb2a-7d52-8089-ae47-f91a1e514896" class=""><strong>Upside: </strong>This organization is convenient because the OS designer doesn’t have to decide which parts of the operating system <mark class="highlight-red">should be given full hardware privilege</mark>. It is also easier for different parts of the OS to cooperate on a <mark class="highlight-red">single code base</mark>.</p><p id="1056cb2a-7d52-80d9-9ff7-f761be9f3de9" class=""><strong>Downside</strong>: A downside of the monolithic organization is that the <mark class="highlight-red">interfaces </mark>between different parts of the operating system are often <mark class="highlight-red">complex </mark>and therefore it is easy for an operating system developer to make a <mark class="highlight-red">mistake</mark>. In a monolithic kernel, <mark class="highlight-red">a mistake is fatal</mark>, because an error in supervisor mode will often cause the kernel to fail. If the kernel fails, the computer stops working, and thus all applications fail too. The computer must reboot to start again.</p></div></p><p id="1056cb2a-7d52-80ce-8451-c523b1c01d79" class=""><strong>Microkernel</strong>:  Minimizing the amount of operating system code that runs in supervisor mode, and execute the bulk of the operating system in user mode. This is a <mark class="highlight-red">minimalist </mark>approach to OS design. Only the most essential functions are provided outright. The kernel consists of a few low-level functions for starting applications sending messages, accessing device hardware, etc.<div class="indented"><p id="10e6cb2a-7d52-8002-8748-ced51936b28d" class=""><strong>Upside</strong>: Much more modular and customizable as compared to the monolithic kernel. Since services are usually provided in user space, there is alot of customizability. The issue of one part failing causing the entire kernel to fail is significantly lessened.</p><p id="5bb59b81-445a-4242-a831-8a7c422aa888" class=""><strong>Downsides: </strong>Microkernels usually require very sophisticated and complex designing in order to provide the bare functionality possible and also being modular enough for its intended purpose.</p></div></p><p id="1086cb2a-7d52-80f4-869f-eec3b3b8cdfc" class="">The difference between monolithic kernels and microkernels is irrelevant for this course.</p><h2 id="1086cb2a-7d52-8026-b851-eb1c14cf00ab" class="">Process overview</h2><p id="033bcf23-8979-47cd-a0e3-94e604be1d58" class="">The unit of isolation in Xv6 is a <mark class="highlight-red">process</mark>. A process undergoes many levels of abstraction so that it does not cause any problems to other processes or to the kernel itself.</p><p id="a9d7be9e-a765-4106-a80a-2aed541ca788" class="">All of these measures are necessary to take because we <mark class="highlight-red">cannot </mark><mark class="highlight-red"><strong>trust</strong></mark><strong> </strong>any user made process. </p><p id="1086cb2a-7d52-8014-ad21-fcad7bec8919" class="">Mechanism used by the kernel to implement isolation</p><ol type="1" id="1086cb2a-7d52-80ff-b59a-f79a925b6763" class="numbered-list" start="1"><li>User/Supervisor mode <mark class="highlight-red">flags</mark></li></ol><ol type="1" id="1086cb2a-7d52-8001-ba39-dff3c8d6e46e" class="numbered-list" start="2"><li>Address spaces (VAS)</li></ol><ol type="1" id="1086cb2a-7d52-80ed-bc74-ffcea7074022" class="numbered-list" start="3"><li><mark class="highlight-red">Time-Slicing</mark> of threads (To stop processes from hogging all the runtime)</li></ol><p id="1086cb2a-7d52-8086-9729-d2d5a2aab477" class="">The main technique of enforcing <mark class="highlight-red">isolation</mark> is that the OS provides the <mark class="highlight-red">illusion</mark> to a program that is has its own <mark class="highlight-red">private machine</mark>. With a CPU (Thread) and its own Memory (VAS).</p><p id="f67817e7-c824-45b3-9044-4b4f3ee2854d" class="">Each process is given a page table to give it its own address space. The RISC-V page table translates a virtual address to a physical address.</p><figure id="1086cb2a-7d52-8088-9e85-e6fb4ef9a7e2" class="image"><a href="image%207.png"><img style="width:249px" src="image%207.png"/></a></figure><p id="b3d7277d-ad70-4619-82b1-9bd618ddeabf" class="">The maximum address for the VAS is 2^38 - 1.</p><p id="1086cb2a-7d52-80b6-a346-f3bed6149fcc" class="">Each process also has a <mark class="highlight-red">trampoline page</mark> and a <mark class="highlight-red">trapframe page</mark>. Xv6 uses these two pages to transition into the kernel and back; the trampoline page contains the code to transition in and out of the kernel, and the trapframe is where the <mark class="highlight-red">kernel saves the process’s user registers</mark>. (More about this thoroughly explain in chapter 4)</p><p id="1086cb2a-7d52-80f6-ba9b-c25f23f6dca8" class="">The many states of a process is all contained under one struct in the code. <code>Struct proc</code>.</p><p id="7ed088b5-1748-414b-a96d-f4243a0a88bf" class="">A process’s most important pieces of kernel state are its <mark class="highlight-red">page table</mark>, its <mark class="highlight-red">kernel stack</mark> and its <mark class="highlight-red">run state</mark>.</p><p id="1086cb2a-7d52-8016-b919-ecdf68cb1487" class="">Each process has a thread of control (or thread for short) that holds the state needed to execute the process. At any given time, a thread might be <mark class="highlight-red">executing </mark>on a CPU, or <mark class="highlight-red">suspended </mark>(not executing, but <mark class="highlight-red">capable </mark>of resuming executing in the future). To switch a CPU between processes, the kernel <mark class="highlight-red">suspends </mark>the thread currently running on that CPU and saves its state, and <mark class="highlight-red">restores </mark>the<br/>state of another process’s previously-suspended thread. Much of the state of a thread (local vari<br/>ables, function call return addresses) is stored on the <br/><mark class="highlight-red">thread’s stacks</mark>. Each process has two stacks:<br/>a <br/><mark class="highlight-red">user stack</mark> and a <mark class="highlight-red">kernel stack</mark> (p-&gt;kstack). When the process is executing user instructions,<br/>only its user stack is in use, and its kernel stack is empty. When the process enters the kernel (for<br/>a system call or interrupt), the kernel code executes on the process’s kernel stack; while a process<br/>is in the kernel, its user stack still contains saved data, but isn’t <br/><mark class="highlight-red">actively used</mark>. A process’s thread<br/>alternates between actively using its user stack and its kernel stack. <br/><mark class="highlight-red">The kernel stack is separate<br/>(and protected from user code) so that the kernel can execute even if a process has wrecked its user<br/>stack.<br/></mark></p><p id="1086cb2a-7d52-8067-a65a-cb4bb2752e4f" class="">A process can make a system call by executing the RISC-V <code>ecall</code> instruction. This instruction<br/>raises the hardware privilege level and changes the <br/><mark class="highlight-red">program counter to a kernel-defined entry<br/>point.<br/></mark> The code at the entry point switches to the <mark class="highlight-red">process’s kernel stack</mark> and executes the kernel<mark class="highlight-red"><br/>instructions that implement the system call<br/></mark>. When the system call completes, the kernel switches<br/>back to the <br/><mark class="highlight-red">user stack</mark> and returns to <mark class="highlight-red">user space</mark> by calling the sret instruction, which lowers<br/>the hardware privilege level and resumes executing user instructions just after the system call<br/>instruction. A process’s thread can “<br/><mark class="highlight-red">block</mark>” in the kernel to wait for I/O, and resume where it left<br/>off when the I/O has finished<br/></p><p id="1086cb2a-7d52-8002-bf4c-cba9f4c61f04" class="">In Xv6 a process consists of one address space and one thread. In most used OS’s a process may have more than one thread to take advantage of multiple CPUs.</p><p id="e4de517c-bbb3-4b1e-8b23-3ddedd34536a" class="">Control and status registers (Very important to understand the flow of things)</p><ul id="1fa37eaf-5128-415c-be0d-5536d8441125" class="bulleted-list"><li style="list-style-type:disc">These are instructions like <code>ecall</code>, that control parts of the execution</li></ul><ul id="dd4da9ef-85f3-4acf-a5d4-8ec062852741" class="bulleted-list"><li style="list-style-type:disc">Privileged Hardware</li></ul><div id="a00fe8dc-1fdb-44f5-b3b5-0e7f2b65c63d" class="column-list"><div id="2236db7e-988b-4f71-bfd8-624b6f952311" style="width:50%" class="column"><p id="36bfec6b-9d45-4b58-b67e-e1dfa39d1690" class="">Hardware wise</p><ul id="c23c2ed0-4315-4b7a-9ecf-a5c64faafcc8" class="bulleted-list"><li style="list-style-type:disc">User Mode</li></ul><ul id="023633df-ad6c-4c05-b00f-2640610ac2c2" class="bulleted-list"><li style="list-style-type:disc">Supervisor mode</li></ul><ul id="db80e10e-55a3-410e-9042-571673001816" class="bulleted-list"><li style="list-style-type:disc">Machine mode</li></ul><ul id="681176b6-4eb8-4b7b-948c-0f72ff1a612f" class="bulleted-list"><li style="list-style-type:disc">Hypervisor mode </li></ul></div><div id="2207305b-2a44-4be3-82e5-ba0c05811ba5" style="width:50%" class="column"><p id="0f515515-3e98-4029-a41f-b1f43b333454" class="">Software wise</p><ul id="1604f045-f840-4c65-a045-ea458fb6a4c2" class="bulleted-list"><li style="list-style-type:disc">User space</li></ul><ul id="1a88562e-c797-446b-9d7f-cd8e25b6faf2" class="bulleted-list"><li style="list-style-type:disc">Kernel space</li></ul><p id="5cc54429-c515-441f-9762-97ab5cc5ed24" class="">
</p></div></div><p id="383b7a65-f32c-47e5-8c5d-fbbbf0776b57" class="">(you can say there is a correspondence between user mode, user space, and also supervisor mode and kernel mode)</p><p id="fc57545e-cfd4-4ef5-9517-e012965edcdd" class="">ecall is a <mark class="highlight-red">hardware counterpart</mark> of system calls. (ecall = environment call)</p><p id="1ad5b389-1cc3-4109-a672-02ec2ba20634" class="">QEMU is 64 bit architecture.</p><p id="89269af4-a144-4db4-925d-9e94e291c66f" class="">A process is one mega data structure.</p><p id="e76056a7-b874-4df8-9e20-2577db231aef" class="">( SILVER SHATS???? new book ) </p><p id="c1fb7b9c-453d-40f7-94a2-cd26432b2b52" class="">Memory mapping and Memory mapped registers are important for accessing registers without using the VAS. (VAS may not necessary be on or enabled all the time)</p><p id="0efa4d8a-3e84-48eb-83b0-566d55ca38aa" class="">Cores can interrupt other cores. (This is to ask for additional work, scheduling, stopping from going into loops etc. (this is speculation on my side)</p><p id="5b1b8f33-9137-4463-a5cc-ff89a796a18a" class="">CSRR - Control and Status Register Read. (Similar instructions for other things)</p><p id="5df94322-067f-438f-8d9b-1c3c5fc97591" class="">mhartid - this is the starting location of the cores, that the machine mode will implement.</p><p id="fced8d6d-9ddc-45aa-9646-08e570f75c49" class="">Each core has its own respective stack.</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>